<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Tables</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <!-- VENDOR CSS -->
    <link rel="stylesheet" th:href="@{|/static/js/vendor/bootstrap/css/bootstrap.min.css|}">
    <link rel="stylesheet" th:href="@{|/static/js/vendor/font-awesome/css/font-awesome.min.css|}">
    <link rel="stylesheet" th:href="@{|/static/js/vendor/linearicons/style.css|}">
    <!-- MAIN CSS -->
    <link rel="stylesheet" th:href="@{|/static/css/main.css|}">
    <!-- FOR DEMO PURPOSES ONLY. You should remove this in your project -->
    <link rel="stylesheet" th:href="@{|/static/css/demo.css|}">
    <!--LAYUI CSS-->
    <link rel="stylesheet" th:href="@{|/static/js/layui/css/layui.css|}">
    <!--ZTREE CSS-->
    <link rel="stylesheet" th:href="@{|/static/ztree/zTreeStyle.css|}">
    <!-- GOOGLE FONTS -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" rel="stylesheet">
    <!-- ICONS -->
    <link rel="apple-touch-icon" sizes="76x76" th:href="@{|/static/img/apple-icon.png|}">
    <link rel="icon" type="image/png" sizes="96x96" th:href="@{|/static/img/favicon.png|}">
    <link rel="icon" type="image/png" th:href="@{|/static/droppable/img/del.png|}">
    <link rel="icon" type="image/png" th:href="@{|/static/droppable/img/infor.png|}">

    <link rel="stylesheet" th:href="@{|/static/droppable/css/reset.css|}">
    <link rel="stylesheet" th:href="@{|/static/droppable/css/sweet-alert.css|}">
    <link rel="stylesheet" th:href="@{|/static/droppable/css/select.css|}">

    <!-- Javascript -->
    <script th:src="@{|/static/js/vendor/jquery/jquery.min.js|}"></script>
    <script th:src="@{|/static/js/vendor/bootstrap/js/bootstrap.min.js|}"></script>
    <script th:src="@{|/static/js/vendor/jquery-slimscroll/jquery.slimscroll.min.js|}"></script>
    <!--<script th:src="@{|/static/js/klorofil-common.js|}"></script>-->
    <script th:src="@{|/static/js/layer/layer.js|}"></script>
    <script th:src="@{|/static/js/layui/layui.js|}"></script>
    <script th:src="@{|/static/js/vendor/common.js|}"></script>
    <script th:src="@{|/static/ztree/jquery.ztree.all-3.5.min.js|}"></script>
    <script th:src="@{|/static/droppable/js/jquery.min.js|}"></script>
    <script th:src="@{|/static/droppable/js/jquery-ui.min.js|}"></script>
    <script th:src="@{|/static/droppable/js/jquery.top-droppable.js|}"></script>
    <script th:src="@{|/static/droppable/js/sweet-alert.min.js|}"></script>
    <script th:src="@{|/static/js/vendor/jtopo/jtopo-min.js|}"></script>

</head>

<body>
<!-- WRAPPER -->
<div id="wrapper">
    <!-- NAVBAR -->
    <div id="header" th:include="/commons/header :: headerContext"></div>
    <!-- END NAVBAR -->
    <!-- LEFT SIDEBAR -->
    <div id="left_sidebar" th:include="/commons/left_sidebar :: leftContext"></div>
    <!-- END LEFT SIDEBAR -->
    <!-- MAIN -->
    <div class="main">
        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="container-fluid">
                <!--<h3 class="page-title">Tables</h3>-->
                <ol class="breadcrumb">
                    <li><a th:href="@{|#|}">首页</a></li>
                    <li><a th:href="@{|#|}">资源管理</a></li>
                    <li class="active">工单管理</li>
                </ol>
                <div class="row">
                    <div class="col-md-12">
                        <!-- BASIC TABLE -->
                        <div class="panel">
                            <div class="panel-body">
                                <!--<canvas id="canvas" width="985" height="400"></canvas>-->
                                <div class="select-wrapper">
                                    <div class="div-group">
                                        <br>
                                        <h2 style="font-size: 18px">资源号码列表（请将号码拖到对应的设备端口中）</h2>
                                        <br>
                                        <div class="width-38 clearfix">
                                            <div class="people-list pink-border-color border-2px ">
                                                <ul class="list-wrapper clearfix" id="leader-wrapper">
                                                </ul>
                                            </div>
                                        </div>
                                        <br>
                                        <h2 style="font-size: 18px">设备及端口清单</h2>
                                        <br>
                                        <!--<div class="width-58 clearfix">-->
                                        <div class="div-group">
                                            <div class="form-content pink-border-color border-2px clearfix" data-bs="lead" id="leading">
                                                <!--<div class="form-left">-->
                                                    <!--<div class="form-title pink-bg-color">部门负责人</div>-->
                                                <!--</div>-->
                                                <!--<div class="form-right">-->
                                                    <div class="score-wrapper clearfix">
                                                        <div class="score-f">
                                                            <span class="score-span blue-bg"></span>
                                                            端口1 :
                                                        </div>
                                                        <div class="top-droppable pink-border-color people-group clearfix">
                                                            <div>1</div>
                                                            <div>1</div>
                                                            <div>1</div>
                                                            <div>1</div>
                                                        </div>
                                                    </div>
                                                <!--</div>-->
                                            </div>
                                            <br>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <!-- END BASIC TABLE -->
                    </div>
                    <!--</div>-->
                </div>

            </div>
        </div>
        <!-- END MAIN CONTENT -->
    </div>
    <!-- END MAIN -->
    <div class="clearfix"></div>
    <div id="footer" th:include="/commons/footer :: footerContext"></div>

</div>
<!-- END WRAPPER -->
<script type="text/javascript" th:inline="javascript">

    // $(function () {
    //     var canvas = document.getElementById('canvas');
    //     var stage = new JTopo.Stage(canvas);
    //     var scene = new JTopo.Scene(stage);
    //
    //     scene.background='[[@{|/static/img/background.jpg|}]]';
    //     stage.add(scene);
    // })

    var resourceList = [[${session.resourceList}]];
    var equipmentList = [[${session.equipmentList}]];


    $(function() {
        showResourceList5(resourceList.length,$("#leader-wrapper"),'lead',resourceList);
        // 放在加载人员的函数里
        changeHeight();
        $(".list-wrapper>li").draggable({
            revert: true
        });
        // 拖拽追加事件
        $(".top-droppable").topDroppable({
            drop: function (e, ui) {
                var parentNode=$(this).parents(".form-content");
                var parentNextNode=$(this).parents(".width-53").next().find(".people-list");
                var jScore=Number($(this).next("div").find(".numSpan").text());
                var totalScore=Number($(this).next("div").find(".totalNum").text());
                if($(ui.draggable[0]).attr("data-bs")==parentNode.attr("data-bs")){
                    if($(this).next(".score-xz").hasClass("num-xz")){
                        if((jScore)<totalScore){
                            $(this).next("div").find(".numSpan").html(jScore+1)
                        }else{
                            alert("超出可选人数上限");
                            return
                        }
                    }else{
                        $(this).next("div").find(".numSpan").html(jScore+1)
                    }
                    $(this).parents(".form-content").height("auto");
                    $(this).parents(".width-53").next().find(".people-list").height("auto");
                    $(this).append("<div class='"+$(ui.draggable[0]).attr('id')+"'>"+$(ui.draggable[0]).text()+"<span class='del'></span></div>");
                    $(ui.draggable[0]).hide();
                    changeHeight()
                }else{
                    alert("不可越界")
                }
            }
        }).droppable({
            tolerance: "pointer"
        });
        $(".score-wrapper").on("click",".del",function(){
            var parentNode=$(this).parents(".form-content");
            var parentNextNode=$(this).parents(".width-53").next().find(".people-list");
            var jScore=Number($(this).parents(".score-wrapper").find(".score-xz").find(".numSpan").text());
            var totalScore=Number($(this).parents(".score-wrapper").find(".score-xz").find(".totalNum").text());
            $("#"+$(this).parent().attr("class")).show();
            if(jScore>0){
                $(this).parents(".score-wrapper").find(".score-xz").find(".numSpan").html(jScore-1)
            }
            $(this).parent().remove();
            if(parentNextNode.height()>parentNode.height()){
                parentNode.height(parentNextNode.height())
            }
        })
        $(window).resize(function(){
            changeHeight()
        })
    });
    function showResourceList(num,parent,bmName,resourceList) {
        var leadHtml='';
        for(var i=0;i<num;i++){
            leadHtml+='<li id="'+bmName+i+'" data-bs="'+bmName+'">' +
                '<span class="name">'+resourceList[i].resource_no+'</span>' +
                // '<span class="infor"></span>' +
                '</li>'
        }
        $(parent).html(leadHtml);
    }
    // 左右高度相等函数
    function changeHeight(){
        var divGroup=$(".div-group");
        for(var i=0;i<divGroup.length;i++){
            var parentNode=$(divGroup[i]).find(".form-content");
            var parentNextNode=$(divGroup[i]).find(".people-list");
            parentNode.height("auto");
            parentNextNode.height("auto");
            if(parentNode.height()<parentNextNode.height()){
                parentNode.height(parentNextNode.height())
            }else{
                parentNextNode.height(parentNode.height())
            }
        }
    }

</script>
</body>

</html>
